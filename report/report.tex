\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts

% ---------- Packages ----------
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{svg}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{url}
\usepackage{hyperref}
\graphicspath{{fig/}}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}%
\kern-.08em T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

%=======================================================================================================================
\begin{document}

\title{Analysis of TLC Trip Record Data}

\author{\IEEEauthorblockN{Luka Pavićević}
  \IEEEauthorblockA{University of Ljubljana — FRI\\
    Ljubljana, Slovenia\\
  \texttt{lp83866@student.uni-lj.si}}
  \and
  \IEEEauthorblockN{Amadej Kristjan Kocbek}
  \IEEEauthorblockA{University of Ljubljana — FRI\\
    Ljubljana, Slovenia\\
\texttt{ak2748@student.uni-lj.si}}}

\maketitle

%=======================================================================================================================
\begin{abstract}
  This report provides a thorough analysis of trip record data from the New York City Taxi and Limousine Commission (TLC),
  covering Yellow Taxi, Green Taxi, For-Hire Vehicle (FHV) and High-Volume For-Hire Vehicle (HVFHV) services. The primary
  objective is to gain an understanding of the complex dynamics of urban transportation in New York City by examining
  temporal and spatial trends, market share distribution and the impact of external factors. The analysis uses a
  multi-source approach, combining weather data, points of interest and public holiday information with the core trip
  record datasets. A notable feature of this study is the implementation of a real-time data processing pipeline using
  Apache Kafka to model and analyse streaming trip data. The findings reveal a significant market shift towards
  high-volume for-hire services, distinct operational patterns between different service types and the profound impact of
  the pandemic on the city's transport ecosystem. These insights are a valuable resource for urban planning,
  transportation policy and business strategy in the evolving landscape of urban mobility.
\end{abstract}

% \begin{IEEEkeywords}
%   big data, CRISP-DM, Dask, DuckDB, Kafka, TLC, mobility analytics,
%   streaming
% \end{IEEEkeywords}

%=======================================================================================================================
\section{Introduction}

The way people get around New York City has changed a lot in the last ten years. The growth of app-based, for-hire
vehicle services has completely changed the way people move around the city, putting traditional taxi services under
pressure. This report looks closely at the large amount of trip record data collected by the New York City Taxi and
Limousine Commission (TLC). By examining data from Yellow Taxis, Green Taxis, For-Hire Vehicles (FHVs), and High-Volume
For-Hire Vehicles (HVFHVs), this report aims to find the patterns and trends that define the city's transportation.
Through a detailed exploration of temporal and spatial data, we seek to understand the operation of
each service, the competitive dynamics at play, and the broader shifts in consumer behavior. This report also looks at
how real-time data processing technologies can be used to understand the continuous flow of trip data, offering a
forward-looking view on how such systems can be used for dynamic analysis and prediction. The most important aim of
this research is to provide a clear picture of how New York City's transportation system has developed, using facts and
statistics to help policymakers, industry leaders, and the public make informed decisions.

%=======================================================================================================================
\section{Business Understanding}

The core business objective of this analysis is to derive strategic intelligence from the vast and complex TLC
trip record datasets. This will inform decision-making for various stakeholders in the New York City transportation
market. For regulatory bodies like the TLC, it is crucial to understand the granular details of trip patterns, service
distribution and market competition. This is essential for developing effective policies that ensure fair competition,
service accessibility and public safety. This analysis is essential for existing and prospective transportation service
providers. It offers a comprehensive market landscape assessment, identifying high-demand areas, peak service times and
underserved markets. This information is vital for optimising fleet management, pricing strategies and service expansion
plans. It is clear that insights into mobility patterns are vital for urban planners and city officials. These insights
provide a foundation for infrastructure planning, traffic management and the development of integrated, multi-modal
transportation systems. This report will provide stakeholders with a predictive understanding of the market, enabling
more proactive and data-informed business and operational strategies.

%=======================================================================================================================

\section{Data Understanding}
The analysis utilizes four distinct datasets: Yellow Taxi, Green Taxi, For-Hire Vehicle (FHV), and High-Volume
For-Hire Vehicle (HVFHV) trip records. This data was acquired from the
\href{https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page}{NYC Taxi and Limousine Commission (TLC)}.
Each dataset is organized by year, month, and vehicle type, and is provided in a comma-separated value (CSV) format.

Within these trip records, location information for pickups and drop-offs is represented by numerical identifiers
ranging from 1 to 263, \ref{fig:nyc-zones-map}. For FHV records prior to 2017, only pickup locations are consistently
available. These numerical IDs correspond to specific Taxi Zones, which can be integrated with the trip records through
a join operation using independently downloadable tables or geospatial files (maps/shapefiles). It is important to note
that these Taxi Zones are derived from the NYC Department of City Planning's Neighborhood Tabulation Areas (NTAs),
thereby providing a neighborhood-level approximation for trip origins and destinations.

\begin{figure}[htbp]
  \label{fig:nyc-zones-map}
  \centering
  \includesvg[width=\linewidth]{figures/nyc_taxi_zones_map_with_ids.svg}
  \caption{Geographical shape for each location in New York}
\end{figure}

\subsubsection*{Yellow Taxi Dataset}
Data pertaining to trips made by New York City's yellow taxis has been collected and submitted to the NYC Taxi and
Limousine Commission (TLC) since 2009. Yellow taxis primarily operate via street hails but are increasingly accessible
through e-hail applications such as Curb and Arro. Notably, yellow taxis possess exclusive rights to respond to street
hails across all five boroughs of New York City.
Each trip record includes comprehensive details such as pick-up and drop-off timestamps, geographic coordinates for
pick-up and drop-off locations, total trip distance, itemized fare breakdowns, rate codes, payment methods, and
driver-reported passenger counts. These data points are compiled and furnished to the TLC by various technology
service providers.

\subsubsection*{Green Taxi Dataset}
Green taxis, formally known as boro taxis and street-hail liveries, were introduced in August 2013. This initiative
aimed to enhance taxi service accessibility within New York City's boroughs. Unlike yellow taxis, green taxis are
restricted in their street hail operations, being permitted only above W 110th St/E 96th St in Manhattan and throughout
the other boroughs.
The dataset for green taxi trips includes fields detailing pick-up and drop-off dates and times, geographic locations
for pick-up and drop-off, trip distances, itemized fare components, rate codes, payment types, and driver-reported
passenger counts. Consistent with yellow taxi data, these records are collected and provided to the NYC Taxi and
Limousine Commission (TLC) by various technology service providers.

\subsubsection*{For-Hire Vehicle and High Volume For-Hire Vehicle Datasets} The For-Hire Vehicle (FHV) dataset
encompasses trip data from a range of bases, including high-volume for-hire vehicle (HVFHV) dispatchers (e.g., Uber,
Lyft, Via, Juno, defined by dispatching $\ge$10,000 trips daily), community livery bases, luxury limousine bases,
and black car bases.

The TLC began receiving FHV trip data in 2015, with the completeness of information evolving over time. Initially,
in 2015, records included only the dispatching base number, pickup date/time, and pickup location ID. By summer 2017,
the TLC mandated the inclusion of drop-off date/time and drop-off location. Also in 2017, information on shared rides
(e.g., Lyft Line, Uber Pool), defined as trips specifically reserved as shared services, began to be reported. Following
the introduction of the high-volume license type in February 2019, a high-volume license number was added as an
overarching identifier for app companies.
To identify the dispatching base for an FHV trip, the dispatching\_base\_num field can be joined with the License Number
field from a corresponding base license registry. For HVFHV bases, the recognized company name may differ from the base
name. Currently, Juno, Lyft, Uber, and Via are the primary companies with or applying for HVFHV licenses.

\subsection{Data Volume}
The \ref{tab:raw-volumes} reveals the significant scale of the urban transportation data. The Yellow Taxi dataset,
covering trips from 2012 onwards, is the largest by row count at 1.261 billion rows (17.4 GB). While the High-Volume
For-Hire Vehicle (FHVHV) data, initiated in 2019, spans a considerably shorter time window, it comprises a substantial
1.236 billion rows and represents the largest storage volume at 31.3 GB. This indicates an exceptionally high density
of trip records within the FHVHV dataset's more recent period. Green Taxi data (2014-) and general FHV data (2015-)
contribute 0.083 billion rows (1.3 GB) and 0.796 billion rows (5.8 GB) respectively. Collectively, the datasets
represent billions of individual trip records, accumulating over 55 GB of raw data, providing a robust foundation
for in-depth analysis of New York City's diverse transportation landscape.

\begin{table}[]
  \label{tab:raw-volumes}
  \caption{Dataset volumes as recieved from the TLC APIs }
  \centering
  \begin{tabular}{ccc}
    \textbf{Dataset}& \textbf{Rows}& \textbf{Size}\\
    \hline \hline
    Yellow Taxi (2012-)&1.261& 17.4\\
    Green Taxi (2014-)&0.083& 1.3\\
    FHV (2015-)&0.796& 5.8\\
    FHVHV (2019-)&1.236& 31.3\\
    \hline
    \multicolumn{3}{c}{(rows data is provided in bilions, and size in gigabytes)}
  \end{tabular}
\end{table}

\subsection{Key Variables}
From Yellow and Green Taxi datasets, we retained: Pick-up/Drop-off Date/Time (for temporal analysis and trip duration),
Passenger Count, Trip Distance, Pick-up/Drop-off Location ID (for spatial patterns), Payment Type, Fare Amount, and
Total Amount (for financial insights). Notably, tips were not utilized for these datasets as they are only recorded
for trips paid via credit card, limiting their comprehensive applicability. The Green Taxi dataset also uniquely
includes Trip Type to differentiate service models.

For the For-Hire Vehicle (FHV) dataset, all available columns were kept to as the initial dataset provided only the
essential columns, and we will be utilizing all of them.

The High-Volume For-Hire Vehicle (FHVHV) dataset includes more granular detail: HVFHS License Number (to identify app
companies), Request/On Scene/Pick-up/Drop-off Date/Time (for detailed service lifecycle analysis), Pick-up/Drop-off
Location ID, and Trip Miles. Financial transparency is enhanced by detailed fare components: Base Passenger Fare, Tolls,
Black Car Fund Surcharge, Sales Tax, Congestion Surcharge, Airport Fee, and Tips.

This selective retention of columns across datasets supports a focused and effective analysis of New York City's diverse
transportation landscape.

\subsection{Data ininconsistencies (Task 1)}
During the initial data repartitioning phase, we identified a notable anomaly: certain trip records possess pickup and
dropoff datetimes that fall outside the expected temporal range for which the datasets were acquired.
For instance, the Yellow Taxi dataset, which was downloaded for records starting from 2012, contains entries
with dates as early as 2001.

However, it's crucial to apply a nuanced approach to these temporal checks. Special consideration should be given to
dates that fall between the documented start date of a dataset and the actual earliest timestamp present in a specific
downloaded file. This is because data often enters the system with a slight delay or historical data might be backfilled,
leading to legitimate records that appear "late" within the file's individual month/year partition but are still within
the overall collection window. For instance, a 2014 record in a 2015 dataset for which the original data started in 2014
would be valid. Our focus will be on identifying and understanding truly erroneous dates, such as the 2001 Yellow Taxi
example, which clearly predate any reasonable data collection period. This meticulous temporal validation ensures the
integrity of our time-series analysis and prevents the inclusion of out-of-scope data.

%=======================================================================================================================

\section{Data Preparation}

This section details the process of identifying and rectifying data inconsistencies to ensure the dataset comprises only
correctly entered records. We'll focus on filtering outliers and correcting anomalies in key fields. Special attention
will be given to pickup and dropoff datetimes, as previously noted, to remove entries outside valid operational periods.
Additionally, we'll address other numerical outliers, such as unrealistically high or low fare amounts, to enhance data
integrity for subsequent analysis.

\subsection{Data Cleaning (Task 2)}
A systematic data cleaning and filtering process was applied to each dataset. This process focused on identifying and
addressing common data inconsistencies and outlier values. Dask was used for efficient processing of the large datasets.

For the Yellow Taxi and Green Taxi datasets, the following conditions were used to identify problematic rows:
\begin{itemize}
  \item \emph{Temporal Inconsistencies}: Records where the Pickup Datetime was equal to or occurred after the
    Dropoff Datetime. These indicate illogical trip durations.
  \item \emph{Trip Distance Outliers}: Trips with a Trip distance less than or equal to 0, or greater than 100 miles. A
    zero or negative distance is invalid, while distances exceeding 100 miles are considered extreme outliers for
    typical New York City taxi rides.
  \item \emph{Passenger Count Anomalies}: Trips reporting 0 passengers, which are usually data entry errors.
  \item \emph{Fare Amount Outliers}: Fares less than or equal to \$0, or greater than \$350. Negative or zero fares are
    invalid, and fares exceeding \$350 are considered highly improbable for a single trip.
\end{itemize}

For the For-Hire Vehicle (FHV) dataset, given its more limited column set, cleaning primarily focused on temporal consistency:
\begin{itemize}
  \item \emph{Temporal Inconsistencies}: Records where Pickup Datetime was equal to or occurred after Dropoff datetime.
\end{itemize}

The High-Volume For-Hire Vehicle (FHVHV) dataset underwent a similar, but slightly adjusted, cleaning process due to its
specific fields:
\begin{itemize}
  \item \emph{Temporal Inconsistencies}: Records where Pickup Datetime was equal to or occurred after Dropoff datetime.
  \item \emph{Trip Miles Outliers}: Trips with Trip Miles less than or equal to 0, or greater than 100 miles.
  \item \emph{Trip Time Outliers}: Records with Trip Time less than or equal to 0, indicating invalid or missing duration.
  \item \emph{Base Passenger Fare Outliers}: Base fares less than or equal to \$0, or greater than \$350.
\end{itemize}

For each dataset, the number of rows identified as problematic based on these criteria was computed and normalized by
the total number of rows per year. These normalized counts provide a clear indication of data quality issues across
different years. This systematic approach ensures that subsequent analyses are performed on a robust and reliable subset
of the data.

\begin{figure}[htbp]
  \centering
  \begin{minipage}[b]{0.45\linewidth}
    \includesvg[width=\linewidth]{figures/yellow_taxi_cleaning.svg}
    \caption{Yellow Taxi Dataset}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\linewidth}
    \includesvg[width=\linewidth]{figures/green_taxi_cleaning.svg}
    \caption{Green Taxi Dataset}
  \end{minipage}

  \vspace{1em}

  \begin{minipage}[b]{0.45\linewidth}
    \includesvg[width=\linewidth]{figures/for_hire_cleaning.svg}
    \caption{For Hire Vehicles Dataset}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\linewidth}
    \includesvg[width=\linewidth]{figures/high_volume_cleaning.svg}
    \caption{High Volume For Hire Vehicles Dataset}
  \end{minipage}

  \caption{Normalized Rows Count That Were Removed From Datasets}

\end{figure}

\subsection{Data Integration (Task 5)}

To get more out of the core TLC trip record data, we added on some extra datasets. This gave us a better overall picture
of how people move around cities. This multi-source approach lets us look at external factors that influence
transportation dynamics.

First, we used hourly weather data to see how the environment affects travel behavior. This data, which was retrieved
from the Open-Meteo archive API, includes measurements of temperature, precipitation (rain, snowfall, and snow depth),
and wind conditions (speed and gusts). By matching each trip's pickup time to the weather conditions at that time, we
can see how different weather affects trip frequency, duration, and demand.

Second, we used the official New York City Taxi Zones shapefile to establish the geographical context. This basic
geographical layer was key to accurately reading the Pick-up Location ID and Drop-off Location ID fields in the trip
data. It gave us the spatial framework we needed to define the boundaries of each taxi zone, enabling detailed
geographical analysis and visualization of trip origins and destinations.

We also integrated points-of-interest (POI) data to understand the activity generators and attractors within each taxi
zone. We used data from the NYC Open Data portal for this. That included school locations, university locations, and a
bunch of other general points of interest. For each trip, we calculated the total number of schools, universities, and
other points of interest in the taxi zone. These new features give us a way to measure local activity, and we can
compare that with trip demand and travel patterns.

We also added a binary flag to the dataset to show if a day was a public holiday in New York State. This lets us look at
different trip patterns and changes in demand that we see during holidays.

It's important to note a limitation regarding external event information. While integrating major city events could
offer valuable insights into surge demand, the available event dataset presented a significant challenge. It relied on
string-formatted addresses, which meant it needed a geolocating service to convert them into geographical coordinates
that could be used. This made it impossible to include it in the project because there weren't enough resources. So, we
couldn't link trip data with specific event-driven demand changes in this analysis.

\subsection{Data Fromat (Task 3)}

The acquired trip record data is very big and its structure is complicated. For this reason, it is very important to
have a strong and efficient data management system to make effective analysis. We compared different data storage \ref{tab:diff-formats}
formats to find the best solution. The assessment included uncompressed CSV, gzipped CSV, HDF5, and DuckDB.
The results clearly showed that DuckDB was the better choice because it used less disk space and loaded data faster.
Specifically, data.duckdb used just 13.6 MB of storage, which is better than the original CSV (59.0 MB), HDF5 (59.3 MB),
and even the gzipped CSV (12.1 MB). While the gzipped CSV was slightly smaller in raw compressed size, it did not have
the same benefits when loading. DuckDB was also very fast at loading data into a Pandas DataFrame, completing the
operation in about 0.031 seconds. This was much faster than HDF5 (0.055 seconds), gzipped CSV (0.692 seconds), and the
original CSV (0.749 seconds). These impressive performance metrics show that DuckDB is the best in-process SQL OLAP
database. It provides a strong and flexible foundation for the next steps in the analysis.

\begin{table}[]
  \label{tab:diff-formats}
  \caption{ Comparison of different formats \\ (data from Green Taxi for year 2024) }
  \centering
  \begin{tabular}{ccc}
    \textbf{Format}& \textbf{Size (MB)}& \textbf{Load Time (s)}\\
    \hline \hline
    CSV&58.99& 0.748\\
    Compressed CSV&12.14& 0.692\\
    HDF5&59.29& 0.054\\
    DuckDB&13.64& 0.030\\
    \hline
  \end{tabular}
\end{table}

%=======================================================================================================================

\section{Exploratory Data Analysis}

In this section, we will look closely at three main areas to better understand our data:
\begin{itemize}
  \item \emph{Temporal Trends:} We'll look at how trip activity changes over time. This includes looking at patterns
    across different times of day, days of the week, and months of the year. Knowing these trends can help us identify the
    times of day when there is the most demand for each vehicle type, as well as the times of year when there is the most
    demand.
  \item \emph{Geographical Patterns:} We'll explore hotspots for pick ups and drop offs in New York City. By looking at
    where people are going, we can see where there's high demand, popular routes, and areas where there's not enough
    service for certain types of vehicles.
  \item \emph{Passenger Counts:} We'll look at the number of passengers on each trip for each service type. This
    analysis can show typical ridership patterns and how each vehicle category is used by individuals or groups.
\end{itemize}
In this section, we'll use visual aids to clearly show our findings. These visual representations will help us identify
important patterns, differences, and relationships within the data. Our goal is to find important information that can
help businesses and city officials make decisions and create plans for urban transportation in New York City.

\subsection{Temporal Trends}

\subsubsection{Hourly Analysis}

\begin{figure}[htbp]
  \label{fig:hourly-line-plot}
  \centering
  \includesvg[width=\linewidth]{figures/normalized_hourly_trip_lineplot.svg}
  \caption{Normalized number of trips per hour of day}
\end{figure}

Yellow Taxis show a steady increase in rides from the early morning, with a prominent evening peak. Green Taxis have a
similar pattern to Yellow Taxis, with a strong evening rush hour, and they have proportionaly the highest number of
rides during this time. FHVs also have their busiest time at 18:00., with a slightly earlier low point compared to taxis.
FHVHVs show a pattern that's very similar to other FHV services, with a strong evening peak and a gradual increase
throughout the day.

\begin{itemize}
  \item \emph{Peak Hours:}  All taxi and for-hire vehicle (FHV) services (like Yellow Taxi, Green Taxi, FHV, and FHVHV)
    are very busy around 18:00 This suggests that there is a strong connection between the end of the typical workday
    and evening commutes.
  \item \emph{Lowest Activity:} The lowest activity for all services is observed in the early morning hours, specifically
    between 03:00 and 05:00. This is consistent with the observation that demand for transportation is typically minimal
    during overnight hours.
  \item \emph{Morning Rush:} There are more rides across all services from 05:00 or 06:00, with a smaller peak in the
    morning around 08:00 - 09:00, probably because of the morning commute.
  \item \emph{Afternoon/Evening Surge:} After a small decrease around lunchtime, there is a big increase in rides that
    builds up through the afternoon, reaching its highest point in the evening.
\end{itemize}

\subsubsection{Daily Analysis}

All services demonstrate higher demand on Fridays and Saturdays, reflecting New York City's vibrant weekend activity.
Green Taxis and FHVHVs exhibited the most significant increase in rides on Saturday compared to other days, potentially
due to increased demand for weekend leisure and social activities, or operating more heavily in residential areas with
higher weekend demand. While Yellow Taxis also experience high demand on Saturday, their peak is on Friday, indicating
strong utilisation during the start of the weekend and potentially for business-related evening events.

\begin{figure}[htbp]
  \label{fig:daily-bar-plot}
  \centering
  \includesvg[width=\linewidth]{figures/normalized_daily_trip_bar.svg}
  \caption{Normalized number of trips per day of week}
\end{figure}

\begin{itemize}
  \item \emph{Weekend Peaks:} All services show a clear trend of increasing normalised ride counts towards the end of
    the week, with Saturday generally being the busiest day. This shows that more people need to travel during the weekend.
  \item \emph{Mid-Week Consistency:} The number of rides is fairly steady from Monday to Wednesday for most services,
    but then it goes up a lot towards the weekend.
  \item \emph{Sunday Activity:} Sunday is usually busier than the early weekdays, but less busy than Friday or Saturday,
    which suggests a different pattern of usage compared to the workweek.
\end{itemize}

\subsubsection{Monthly Analysis}

While Yellow and Green Taxis show a clear decline in summer, FHV and FHVHV services either remain robust or even
increase in demand during these months. This suggests that FHV services could potentially capture demand from tourists
or alternative travel patterns during the traditional vacation season for locals. The significant increase in FHV rides
in the latter half of the year, particularly in December, is distinctive when compared to the more consistent or earlier
peaks of Yellow and Green Taxis. This could be due to holiday shopping, seasonal events, or increased corporate travel.
FHVHV services demonstrate a more stable ridership profile throughout the year, in contrast to the more significant
seasonal fluctuations observed in other services, particularly following the initial decline in January.

\begin{figure}[htbp]
  \label{fig:monthly-bar-plot}
  \centering
  \includesvg[width=\linewidth]{figures/normalized_monthly_trip_bar.svg}
  \caption{Normalized number of trips per month}
\end{figure}

\begin{itemize}
  \item \emph{Seasonal Variations:} All TLC services show different seasonal patterns, with demand going up and down
    during the year.
  \item \emph{Summer Dip (Yellow and Green Taxis):} In the summer months (July and August), there are usually fewer
    people using Yellow and Green Taxis. This could be because New Yorkers are leaving the city for vacations or because
    there is less going on in the city.
  \item \emph{FHV Summer Peak/Stability:} On the other hand, FHV and FHVHV services have a lot of passengers in the
    summer (June, July, August and September for FHV; generally the same for FHVHV). This might suggest they are popular
    with a different type of person or are less affected by typical summer slowdowns, possibly because of tourist
    activity or people travelling for fun.
  \item \emph{Autumn and Winter Increase:} Demand generally increases in the autumn months (September, October) and
    remains strong into the early winter (November, December), with some services peaking in these months.
  \item \emph{Early Year Fluctuations:} The months of January and February demonstrated a diverse range of patterns
    across various services. Some services experienced a decline in activity, for instance, FHV in February and March.
    In contrast, other services demonstrated resilience and remained relatively strong.
\end{itemize}

\subsection{Spatial Trends}

\subsection{Pickup Locations}

\begin{figure}[htbp]
  \label{fig:most-popular-pickup-locations}
  \centering
  \includesvg[width=\linewidth]{figures/pickup_locations_map.svg}
  \caption{The map illustrates the most popular locations for picking up customers in New York}
\end{figure}

\subsubsection*{Yellow Taxis}
The top pickup locations for Yellow Taxis clearly indicate a focus on Manhattan's central business districts, major
transit hubs, and high-density tourist areas. You will find these zones around Midtown, Lower Manhattan and key
hotel/attraction vicinities. This is in line with their traditional role as street-hail vehicles serving the most
concentrated commercial and tourist parts of the city. Overlap with FHV/FHVHV (e.g., 79, 161, 230, 234) indicates shared
demand in highly active zones.

\subsubsection*{Green Taxis} The popularity of Green Taxis' locations is indicative of their mandate to serve areas
outside Manhattan's core,
primarily the outer boroughs (e.g., parts of Queens, Brooklyn, Bronx). These are likely to be local commercial centres,
dense residential neighbourhoods, and transit points within those boroughs. The difference top locations
for Yellow Taxis compared to Green taxis shows that they provide a regulated taxi service in areas where yellow
cabs are less common.

\subsubsection*{FHV and FHVHV} The areas covered by FHV and FHVHV are very similar to each other, as well as to the
popular zones of Yellow Taxi (e.g. 79, 161, 230, 234, 48). This means that these services are very competitive in
Manhattan's main area. The presence of identifiers such as 132, 138, and 61 (for FHV/FHVHV) suggests that these services
also have a very strong presence in areas that may be less saturated by traditional taxis or represent key transit
connections, such as airports. These identifiers are associated with major transportation hubs. Specifically, locations
132 and 138 correspond to two airports within the state of New York, while location 61 is situated in Highland Park. The
FHVHV list, designed for "high-volume" services such as Uber and Lyft, incorporates a range of zones that reflect high
demand across diverse urban contexts. These include areas served by Yellow Taxis and those where ride-sharing has become
predominant.

The data clearly reinforces the intended market segmentation between Yellow and Green Taxis, with Yellow dominating
Manhattan's core and Green dominating outer borough hubs.

It appears that FHV and FHVHV services are in direct competition with Yellow Taxis in areas of high demand in Manhattan.
However, they also maintain a strong presence in other areas, including those traditionally served by Green Taxis or
less adequately served by traditional taxi services.

The fact that different services have different top pickup locations (with some overlaps) indicates that they
collectively cater to the different transportation needs of New York City's residents and visitors across
different areas and times of day

\subsection{Dropoff Locations}

\begin{figure}[htbp]
  \label{fig:most-popular-dropoff-locations}
  \centering
  \includesvg[width=\linewidth]{figures/dropoff_locations_map.svg}
  \caption{The map illustrates the most popular locations for dropping off customers in New York}
\end{figure}

\subsubsection*{Yellow Taxis} The top drop-off locations for Yellow Taxis are very similar to their top pickup locations.
This suggests that Yellow Taxis are mostly used to travel within Manhattan, especially in the busiest areas. People use
Yellow Taxis to get around these areas, and mostly consist of short trips, that start and finish in the centre of Manhattan.

\subsubsection*{Green Taxi} Green Taxi drop-off locations align with their pickup patterns (similar to the Yellow Taxi
dataset), suggesting that their primary function is to facilitate travel within and between neighborhoods in the outer
boroughs. The presence of 61 (a major Queens area) as a top dropoff suggests it is a significant destination for trips
originating in other outer borough locations.

\subsubsection*{FHV and FHVHV} It is important to note that 265 (LaGuardia Airport) was the most popular place for both
FHV and FHVHV to drop off passengers, and 132 (JFK Airport) was also a popular pick. This shows that they play a big
part in getting people from the airport to their destination.

In summary, the dropoff location data highlights the key roles of Yellow and Green taxis in their respective geographic
areas, while emphasising the vital function of For-Hire Vehicles (particularly high-volume ones) in linking the whole
city to major transportation hubs like airports, as well as their pervasive presence in high-demand urban centres.

\subsection{Routes}

\begin{figure}[htbp]
  \label{fig:most-popular-routes}
  \centering
  \includesvg[width=\linewidth]{figures/popular_routes.svg}
  \caption{The map illustrates the most popular routes in New York \\
  (if a location is fully colored in it means that the most popular route is within the same location zone)}
\end{figure}

\subsubsection*{Yellow Taxi} The top four routes are 237-236, 236-237, 236-236 and 237-237. This is very revealing.
IDs 237 and 236 are always some of the most popular places for Yellow Taxis to pick up and drop off customers. This
shows that there is a lot of movement in and out of these two areas of Manhattan. It confirms their role in short,
frequent trips for commuters, business travellers and tourists moving within high-density areas.  The average distance
for these top routes is always low (e.g., 1.06 miles for 237-236, 0.67 miles for 236-236). The average duration is also
quite short (for example, 7.2 minutes for 237-236, and 5.37 minutes for 236-236). Yellow Cab's most popular routes have
a much higher number of passengers (in millions) than other services, showing how popular they are in their main
operating areas. The average fares are moderate, reflecting the short distances.

\subsubsection*{Green Taxi}  The top routes are often the same as Yellow Taxis, with the same pick-up and drop-off
locations. This shows that Green Taxis are used a lot for travelling locally in certain outer-borough areas. Routes
like 75-74, 41-42, and 74-75 suggest that people travel a lot between similar areas in the outer boroughs, which is
what Green Taxis are supposed to do. Green Taxi's routes generally have slightly longer average durations than Yellow
Taxis' (for example, 11-15 minutes), perhaps because they cover longer distances within their zones.On average, the
distances are usually between 1 and 1.3 miles, and the fares match these distances.

For all services, a large part of their most popular routes are where the pickup and dropoff locations are the same.
This shows that a large number of rides for all TLC types are short trips within specific local areas or neighborhoods.

Yellow Taxis are designed for short trips in and around Manhattan. Green Taxis mainly do local trips in the outer
boroughs. FHV/FHVHV offer local trips in many more zones (including those Yellow and Green serve) and also handle
longer, specific point-to-point connections, including airport routes. You can see these when you look at overall
popular PUs/DOs.

\subsection{Service Distribution (Task 8)}

\begin{figure}[htbp]
  \label{fig:service-distribution}
  \centering
  \begin{minipage}[b]{0.95\linewidth}
    \includesvg[width=\linewidth]{figures/visualize_fhvhv_total.svg}
    \caption{Total Rides Count}
  \end{minipage}

  \vspace{1em}

  \begin{minipage}[b]{0.95\linewidth}
    \includesvg[width=\linewidth]{figures/visualize_fhvhv_relative.svg}
    \caption{Relative Rides Count}
  \end{minipage}

  \caption{Monthly Rides by Service in NYC}

\end{figure}

\subsubsection*{Ride Volume Over Time} The line chart \ref{fig:service-distribution} illustrates the number of monthly
rides for each service. As is evident in the dataset, which commenced in 2012, yellow taxis constituted the sole service,
exhibiting a consistent ridership of 13-15 million rides per month. Green Taxis, introduced in 2013 to serve areas
outside of Manhattan's central business district, initially experienced growth but have since seen a significant decline
in ridership. The for-hire vehicle sector, and in particular the high-volume for-hire vehicle segment, has been a major
driver in the growth of ride-sharing apps. Please note the initial high usage in "High-Volume For-Hire Vehicles" since 2019,
which is due to a re-categorization of existing ride-sharing services for regulatory purposes. These services
rapidly eclipsed yellow taxis, becoming the predominant force in the market.

\subsubsection*{Market Shift} Recent market data indicates that Yellow Taxis' market share has decreased from 100\% to
approximately 10-15\%. The most significant finding in this dataset is the dramatic decline in market share. High-volume
for-hire vehicles now account for the majority of the market, consistently capturing over 80\% of all rides in the
post-pandemic era. This indicates a fundamental shift in consumer preference and transportation habits.

If you direct your attention to the sharp dip seen in all the lines in early 2020, this will be of particular interest.
The impact of the pandemic resulted in a significant decrease in all forms of transportation in NYC. While ridership has
been recovering since then, it highlights the vulnerability of the transportation sector to major public health crises.

The data demonstrate clear seasonal patterns, with a notable increase in ridership during the spring and fall, and a
decrease in the summer and winter months. These patterns are evident across all service types, though they are more
pronounced in the pre-pandemic data.

Prior to the pandemic, the emergence of high-volume for-hire services resulted in a significant overall increase in the
total number of rides, indicating that these new services attracted additional customers to the market rather than
simply replacing existing taxi users. However, it appears that the market has reached a saturation point, with the total
number of rides not yet returning to its pre-pandemic peak.

%=======================================================================================================================

\section{Modeling}

We will use Apache Kafka to process data as it comes in. The reason for this choice is the huge amount of data that is
produced every day in the New York City TLC ecosystem. It is very important to be able to deal with a lot of real-time
data in a reliable way. This means you need a strong system that can be used in many different ways and can deal with
problems. One example of this is Kafka. This will let us to collect, process and analyse all the data from the ride,
making sure that our models are always up to date. This is really important for making sure that we can make accurate
predictions and get useful information.

\subsection{Apache Kafka}

\subsubsection*{Producer} A special Python producer application was created to take the sorted trip data and send it to
Kafka. This producer was set up to read the input data in batches of 100,000 records, making sure that the data was
processed quickly. Each batch was published to a designated Kafka topic based on the order in which it was ordered.

\subsubsection*{Consumer} A Python consumer application is running in parallel with the producer, and is subscribed to
the same Kafka topic. Its primary function was to perform real-time analytical calculations on the incoming trip data
stream. Specifically, for each trip, the system retained the window of the 1,000 most recent trips. It then calculated
the mean and standard deviation of the trip durations, fares and trip distances for all New York City boroughs, as well
as for ten pre-selected locations identified as points of interest.

\subsubsection*{Data} The input data consisted of combined trip records from the New York City Yellow Taxi and High
Volume For Hire datasets for the entire year 2021. Prior to ingestion, this comprehensive dataset was sorted
chronologically by trip pickup time to simulate a realistic stream of events.

\subsection{Results}

\begin{figure}[htbp]
  \label{fig:kafka-mean-trip-duration}
  \centering
  \includesvg[width=\linewidth]{figures/mean_trip_duration_boroughs_seaborn.svg}
  \caption{The mean durations of trips, as produced by Kafka consumer}
\end{figure}

Trips from EWR are much longer, which is normal for airport journeys. The mean trip duration is about the same for
Bronx, Brooklyn, Manhattan, Queens and Staten Island. We can see that the trips from Queens are usually a bit longer
and the trips from the Bronx are usually the shortest compared to the other non-EWR boroughs. We can't draw any clear
conclusions from the non-EWR boroughs. The changes we see suggest that any differences are not strong enough to create
clear patterns based on these limited observations.

%=======================================================================================================================
\section{Conclusion}
This detailed study of the New York City TLC trip record data has shown the big changes and small patterns that make up
the city's modern transport picture. The results clearly show that high-volume for-hire vehicles are now the main choice
for consumers, and have had a big impact on the market. This is mostly at the expense of traditional yellow taxis. The
spatial analysis shows that Yellow and Green Taxis work in different areas, and that FHV and HVFHV services are
everywhere, especially in places where there is a lot of demand and where people come and go.

Looking at how things changed over time, we can see clear daily, weekly and seasonal patterns. These are made clearer by
the big and long-lasting effect of the pandemic, from which the market is still recovering. The use of a system that
processes data as it is collected using Apache Kafka showed that this is a good way to analyse large amounts of data as
it is collected.

This analysis is a very important tool for people who work in transport, like transport authorities, service providers
and urban planners. It helps them deal with one of the world's busiest urban transportation systems and create a better,
fairer future for New York City.

%=======================================================================================================================

\appendices
\section{Source code}
All the code that was used to get the results in this report can be found at the GitHub, at the following link
\href{https://github.com/Luka931/big-data-project}{Luka931/big-data-project}.

%=======================================================================================================================
\bibliographystyle{IEEEtran}
% \begin{thebibliography}{00}

%   % — add additional references here as needed —

% \end{thebibliography}

\end{document}
